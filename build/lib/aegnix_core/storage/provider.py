# aegnix_core/storage/provider.py
"""
StorageProvider represents sovereign persistence for identity,
trust state, cryptographic events, replay protection, and capability metadata.
All AEGNIX runtimes must rely on this interface only.
"""


from typing import Protocol, Optional, Dict, Any, List, TYPE_CHECKING

if TYPE_CHECKING:
    # Only imported for type checkers / IDE; no runtime dependency
    from aegnix_core.storage.models import KeyRecord

class StorageProvider(Protocol):
    """Canonical storage contract for AEGNIX runtimes."""

    # # --- Keyring ---
    # def upsert_key(self, rec: KeyRecord) -> None: ...
    # def get_key(self, ae_id: str) -> Optional[KeyRecord]: ...
    # def revoke_key(self, ae_id: str) -> None: ...
    # def fetch_by_fingerprint(self, fpr: str) -> Optional[KeyRecord]: ...
    # def fetch_by_pubkey(self, pubkey_b64: str) -> Optional[KeyRecord]: ...
    # def list_keys(self) -> List[Dict[str, Any]]: ...

    # --- Keyring ---
    def upsert_key(self, rec: "KeyRecord") -> None: ...
    def get_key(self, ae_id: str) -> Optional["KeyRecord"]: ...
    def revoke_key(self, ae_id: str) -> None: ...
    def fetch_by_fingerprint(self, fpr: str) -> Optional["KeyRecord"]: ...
    def fetch_by_pubkey(self, pubkey_b64: str) -> Optional["KeyRecord"]: ...
    def list_keys(self) -> List[Dict[str, Any]]: ...

    # --- Audit ---
    def log_event(self, event_type: str, payload: Dict[str, Any]) -> None: ...

    # --- Replay guard ---
    def seen_msg(self, msg_id: str) -> bool: ...
    def mark_msg(self, msg_id: str) -> None: ...

    # --- Capabilities ---
    def upsert_capability(self, cap) -> None: ...
    def get_capability(self, ae_id: str): ...
    def list_capabilities(self): ...

    # def flush(self) -> None: ...
    # def close(self) -> None: ...
